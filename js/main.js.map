{"version":3,"sources":["file:///Users/lli/Documents/blog/themes/hugo-trainsh/assets/js/main.js"],"sourcesContent":["console.log('This site was generated by Hugo.');\n\ndocument.addEventListener('DOMContentLoaded', () =\u003e {\n  // Mobile nav toggle\n  const navToggleBtn = document.querySelector('[data-nav-toggle]');\n  const navEl = document.querySelector('[data-nav]');\n  if (navToggleBtn \u0026\u0026 navEl) {\n    navToggleBtn.addEventListener('click', () =\u003e {\n      const open = navEl.classList.toggle('is-open');\n      navToggleBtn.setAttribute('aria-expanded', open ? 'true' : 'false');\n    });\n  }\n\n  const toc = document.querySelector('.toc-dropdown');\n  if (toc) {\n    toc.addEventListener('click', (e) =\u003e {\n      const target = e.target;\n      if (target \u0026\u0026 target.tagName === 'A') {\n        toc.open = false;\n      }\n    });\n  }\n\n  // Archive search wiring\n  const searchInput = document.getElementById('archive-search');\n  const groupsEl = document.getElementById('archive-groups');\n  const resultsEl = document.getElementById('archive-results');\n  if (searchInput \u0026\u0026 groupsEl \u0026\u0026 resultsEl) {\n    let fuseInstance = null;\n    let indexData = null;\n\n    const renderResults = (items) =\u003e {\n      if (!Array.isArray(items)) return;\n      if (items.length === 0) {\n        resultsEl.innerHTML = '\u003cp\u003eNo results\u003c/p\u003e';\n        return;\n      }\n      const html = items.map((r) =\u003e {\n        const item = r.item || r; // support raw array or Fuse result\n        const title = item.title || '';\n        const date = item.date || '';\n        const link = item.permalink || '#';\n        const summary = item.summary || '';\n        return `\n          \u003carticle class=\"archive-result\"\u003e\n            \u003ch3\u003e\u003ca href=\"${link}\"\u003e${title}\u003c/a\u003e\u003c/h3\u003e\n            \u003ctime class=\"date\"\u003e${date}\u003c/time\u003e\n            \u003cp class=\"summary\"\u003e${summary}\u003c/p\u003e\n          \u003c/article\u003e\n        `;\n      }).join('');\n      resultsEl.innerHTML = html;\n    };\n\n    const showGroups = () =\u003e {\n      groupsEl.hidden = false;\n      resultsEl.hidden = true;\n    };\n    const showResults = () =\u003e {\n      groupsEl.hidden = true;\n      resultsEl.hidden = false;\n    };\n\n    const initFuse = async () =\u003e {\n      if (fuseInstance) return fuseInstance;\n      if (!indexData) {\n        try {\n          const res = await fetch('/index.json', { cache: 'no-store' });\n          if (!res.ok) return null;\n          indexData = await res.json();\n        } catch (e) {\n          // Fail silently to avoid breaking page\n          return null;\n        }\n      }\n      if (!Array.isArray(indexData)) return null;\n      const options = {\n        includeScore: true,\n        ignoreLocation: true,\n        minMatchCharLength: 2,\n        threshold: 0.3,\n        keys: [\n          { name: 'title', weight: 2 },\n          { name: 'summary', weight: 1 },\n          { name: 'tags', weight: 0.5 },\n          { name: 'categories', weight: 0.5 },\n          { name: 'content', weight: 0.25 }\n        ]\n      };\n      if (window.Fuse) {\n        fuseInstance = new window.Fuse(indexData, options);\n      }\n      return fuseInstance;\n    };\n\n    searchInput.addEventListener('input', async (ev) =\u003e {\n      const q = (ev.target.value || '').trim();\n      if (q.length === 0) {\n        showGroups();\n        return;\n      }\n      const fuse = await initFuse();\n      if (!fuse) return;\n      const results = fuse.search(q).slice(0, 50);\n      renderResults(results);\n      showResults();\n    });\n  }\n\n  // PhotoSwipe lightbox for all images in article content\n  (async () =\u003e {\n    const article = document.querySelector('article.content');\n    if (!article) return;\n\n    try {\n      // Helper to reliably get intrinsic dimensions; falls back to probing the src\n      const getImageDimensions = (src, imgEl) =\u003e new Promise((resolve) =\u003e {\n        const w = (imgEl \u0026\u0026 imgEl.naturalWidth) || 0;\n        const h = (imgEl \u0026\u0026 imgEl.naturalHeight) || 0;\n        if (w \u003e 0 \u0026\u0026 h \u003e 0) {\n          resolve({ width: w, height: h });\n          return;\n        }\n        const probe = new Image();\n        probe.onload = () =\u003e {\n          resolve({\n            width: probe.naturalWidth || 1600,\n            height: probe.naturalHeight || 900\n          });\n        };\n        probe.onerror = () =\u003e resolve({ width: 1600, height: 900 });\n        probe.src = src;\n      });\n\n      const { default: PhotoSwipeLightbox } = await import('https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe-lightbox.esm.min.js');\n      const lightbox = new PhotoSwipeLightbox({\n        gallery: 'article.content',\n        children: 'a[data-pswp-width]',\n        wheelToZoom: true,\n        // dynamic import of core\n        pswpModule: () =\u003e import('https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe.esm.min.js')\n      });\n      lightbox.init();\n\n      // Fallback for anchors that wrap images but have no data-pswp-* attributes\n      const anchorItems = Array.from(article.querySelectorAll('a[href]:not([data-pswp-width])'))\n        .map(a =\u003e ({ a, img: a.querySelector('img') }))\n        .filter(x =\u003e x.img);\n\n      if (anchorItems.length) {\n        const { default: LB } = await import('https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe-lightbox.esm.min.js');\n        const lbLinks = new LB({\n          wheelToZoom: true,\n          pswpModule: () =\u003e import('https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe.esm.min.js')\n        });\n        lbLinks.init();\n        anchorItems.forEach(({ a, img }) =\u003e {\n          a.style.cursor = 'zoom-in';\n          a.addEventListener('click', async (e) =\u003e {\n            e.preventDefault();\n            const src = a.getAttribute('href');\n            const dims = await getImageDimensions(src, img);\n            lbLinks.loadAndOpen(0, [{ src, width: dims.width, height: dims.height, alt: img.alt || '' }]);\n          });\n        });\n      }\n\n      // Fallback for images not wrapped by render hooks (no data-pswp-width)\n      const orphanImgs = Array.from(article.querySelectorAll('img:not(a img)'));\n      if (orphanImgs.length) {\n        const { default: LB } = await import('https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe-lightbox.esm.min.js');\n        const lb = new LB({\n          wheelToZoom: true,\n          pswpModule: () =\u003e import('https://cdn.jsdelivr.net/npm/photoswipe@5/dist/photoswipe.esm.min.js')\n        });\n        lb.init();\n        orphanImgs.forEach((img) =\u003e {\n          img.style.cursor = 'zoom-in';\n          img.addEventListener('click', async () =\u003e {\n            const src = img.currentSrc || img.src;\n            const dims = await getImageDimensions(src, img);\n            lb.loadAndOpen(0, [{ src, width: dims.width, height: dims.height, alt: img.alt || '' }]);\n          });\n        });\n      }\n    } catch (e) {\n      // no-op if CDN blocked\n    }\n  })();\n\n  // Copy-to-clipboard for code blocks\n  document.addEventListener('click', async (ev) =\u003e {\n    const btn = ev.target.closest('[data-copy-code]');\n    if (!btn) return;\n    const wrapper = btn.closest('.codeblock');\n    if (!wrapper) return;\n    // Find the code element\n    const pre = wrapper.querySelector('.highlight pre');\n    if (!pre) return;\n    try {\n      const text = pre.textContent || '';\n      await navigator.clipboard.writeText(text);\n      const original = btn.textContent;\n      btn.textContent = 'Copied';\n      setTimeout(() =\u003e { btn.textContent = original; }, 1200);\n    } catch (e) {\n      // ignore\n    }\n  });\n  \n  // Theme toggle\n  const themeBtn = document.querySelector('[data-theme-toggle]');\n  if (themeBtn) {\n    const root = document.documentElement;\n    const applyTheme = (theme) =\u003e {\n      root.setAttribute('data-theme', theme);\n      localStorage.setItem('theme', theme);\n      themeBtn.setAttribute('aria-label', theme === 'dark' ? 'Switch to light theme' : 'Switch to dark theme');\n    };\n    const current = root.getAttribute('data-theme') || (window.matchMedia \u0026\u0026 window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');\n    applyTheme(current);\n    themeBtn.addEventListener('click', () =\u003e {\n      const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';\n      applyTheme(next);\n      // Notify listeners (e.g., mermaid re-render)\n      try { window.dispatchEvent(new Event('themechange')); } catch (_) {}\n    });\n  }\n});\n"],"mappings":"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","names":[]}